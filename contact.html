<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>markheard.io</title>
  <!-- <link rel="manifest" href="/manifest.json"> -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="./styles/main.css">
  <!-- <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      // Registration was successful
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }).catch(function(err) {
      // registration failed :(
      console.log('ServiceWorker registration failed: ', err);
    });
  }
  </script> -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

</head>

<body>

  <header class="header">
    <h1><img alt="logo for markheard.io" src="./assets/markheardio.svg" /></h1>
  </header>

  <nav class="nav">
    <button class="fab toggle">
      <img alt="menu icon" class="toggle" src="./assets/menu-24px-light.svg" />
    </button>
    <div class="menu">
      <div class="menu-item ">
        <a href="./">Home</a>
      </div>
      <div class="menu-item ">
        <a href="./about">About</a>
      </div>
      <div class="menu-item ">
        <a href="./portfolio">Portfolio</a>
      </div>
    </div>
  </nav>



  <main class="main">
    <div id="content">
      <div class="card grad contact">
        <form class="form">

          <div class="form-title">
            <h1>Contact Me</h1>
            <h3>Got a question?</h3>
            <h3>Send me a message!</h3>
          </div>

          <div class="form-group">
            <label>Name</label>
            <input id="name" type="text" />
          </div>

          <div class="form-group">
            <label>Email</label>
            <input id="email" type="text" />
          </div>

          <div class="form-group">
            <label>Message</label>
            <textarea id="message"></textarea>
          </div>

          <div class="form-group">
            <button id="sendMessage" class="g-recaptcha btn" data-sitekey="6Lf1l9YUAAAAAF3F3RS2JbncOFxHAPMyH7HxWFwj"
              data-callback="onSubmit" data-badge="inline" data-size="invisible">
              Send
            </button>
          </div>
          <div class="form-group">
            <div id="test" class="btn">Testing</div>
          </div>

        </form>

      </div>

    </div>
  </main>

  <div id="modal" class="">
    <div class="modal-bg"></div>
    <div id="modalDialogue"></div>
  </div>



  <script src="./scripts/app.js" async></script>


  <script>

    (function () {

      function sendMessage(e) {
        e.preventDefault();
      }

      document.getElementById("sendMessage").onclick = sendMessage;

      function clearModal() {
        console.log('clearing...')
        document.getElementById('modalDialogue').innerHTML = '';
        document.getElementById('modal').classList.remove('open')
      }

      function closeModal(e) {
        e.preventDefault();
        clearModal();
      }

      function clearContactForm() {
        document.getElementById('name').value = '';
        document.getElementById('email').value = '';
        document.getElementById('message').value = '';
      }



      function openLoadModal() {

        var modalDialogue = document.getElementById('modalDialogue');

        modalDialogue.innerHTML = '';
        modalDialogue.classList.add('loadingModal')

        var loader = document.createElement('DIV');
        loader.classList.add('loader');

        var loaderSVG = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        //loaderSVG.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");

        var loadCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        loadCircle.setAttribute('cx', '100');
        loadCircle.setAttribute('cy', '100');
        loadCircle.setAttribute('r', '80');
        loadCircle.setAttribute('transform', 'rotate(-90 100 100)');

        loaderSVG.append(loadCircle);
        loader.append(loaderSVG);

        var loadMsg = document.createElement('DIV');
        loadMsg.innerHTML = 'Sending...';
        loadMsg.classList.add('loadMsg');
        loader.append(loadMsg);

        modalDialogue.append(loader);

        document.getElementById('modal').classList.add('open');

      }


      function clearLoadModal() {
        var modalDialogue = document.getElementById('modalDialogue');

        modalDialogue.innerHTML = '';
        modalDialogue.classList.remove('loadingModal');
      }

      function setMsgSuccessModal() {
        modalDialogue.innerHTML = '';
        modalDialogue.classList.add('msgSuccessModal');

        var checkContainer = document.createElement('DIV');
        checkContainer.classList.add('check');
        var shortLegContainer = document.createElement('DIV');
        shortLegContainer.classList.add('shortLegContainer');
        var shortLeg = document.createElement('DIV');
        shortLeg.classList.add('shortLeg');
        shortLegContainer.append(shortLeg);
        var longLegContainer = document.createElement('DIV');
        longLegContainer.classList.add('longLegContainer');
        var longLeg = document.createElement('DIV');
        longLeg.classList.add('longLeg');
        longLegContainer.append(longLeg);
        checkContainer.append(shortLegContainer);
        checkContainer.append(longLegContainer);


        var successMsg = document.createElement('DIV');
        successMsg.innerHTML = 'Message Received';
        successMsg.classList.add('successMsg');

        modalDialogue.append(successMsg)
        modalDialogue.append(checkContainer)
        //ACTIONS TO CLEAR
        // modalDialogue.classList.remove('msgSuccessModal');
      }

      function clearMsgSuccessModal(){
        modalDialogue.classList.remove('msgSuccessModal');
      }

      function testMoadlAnimation() {

        //BOILER PLATE CONTROLS
        var modalDialogue = document.getElementById('modalDialogue');
        modalDialogue.innerHTML = '';
        var closeBtn = document.createElement('BUTTON');
        closeBtn.classList.add('closeBtn');
        closeBtn.addEventListener('click', closeModal);
        var closeIcon = document.createElement('IMG');
        closeIcon.setAttribute('src', './assets/close-24px-light.svg');
        closeBtn.append(closeIcon);
        modalDialogue.append(closeBtn);

        //TEST CODE
        modalDialogue.classList.add('msgSuccessModal');

        var checkContainer = document.createElement('DIV');
        checkContainer.classList.add('check');
        var shortLegContainer = document.createElement('DIV');
        shortLegContainer.classList.add('shortLegContainer');
        var shortLeg = document.createElement('DIV');
        shortLeg.classList.add('shortLeg');
        shortLegContainer.append(shortLeg);
        var longLegContainer = document.createElement('DIV');
        longLegContainer.classList.add('longLegContainer');
        var longLeg = document.createElement('DIV');
        longLeg.classList.add('longLeg');
        longLegContainer.append(longLeg);
        checkContainer.append(shortLegContainer);
        checkContainer.append(longLegContainer);


        var successMsg = document.createElement('DIV');
        successMsg.innerHTML = 'Message Received';
        successMsg.classList.add('successMsg');

        modalDialogue.append(successMsg)
        modalDialogue.append(checkContainer)
        //ACTIONS TO CLEAR
        // modalDialogue.classList.remove('msgSuccessModal');

        document.getElementById('modal').classList.add('open');
      }
      document.getElementById('test').addEventListener('click', testMoadlAnimation)

      function onSubmit(token) {

        openLoadModal();

        var url = 'https://test-1-rvw7oyp6nq-uc.a.run.app'

        var message = {
          token: token,
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          message: document.getElementById("message").value
        };

        var xhr = new XMLHttpRequest();

        xhr.open('POST', url, true);
        //Send the proper header information along with the request
        xhr.setRequestHeader('Content-type', 'application/json');
        xhr.onreadystatechange = function () {//Call a function when the state changes.

          if (xhr.readyState == 4 && xhr.status == 200) {

            var data = JSON.parse(xhr.responseText);
            console.log(JSON.stringify(data))
            if (data.success === true) {
              clearLoadModal();
              setMsgSuccessModal()

              //add a success message to the modal

              setTimeout(function () {
                
                clearMsgSuccessModal();
                clearModal();
                clearContactForm();
              }, 5000);

            } else {

              // add an error message to the modal
              // document.getElementById("modal").classList.add("open")

            }
          }
        }
        xhr.send(JSON.stringify(message));

      }
      window.onSubmit = onSubmit

    })();

  </script>

</body>

</html>