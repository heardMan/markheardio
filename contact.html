<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>markheard.io</title>
  <!-- <link rel="manifest" href="/manifest.json"> -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="./styles/main.css">
  <!-- <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      // Registration was successful
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }).catch(function(err) {
      // registration failed :(
      console.log('ServiceWorker registration failed: ', err);
    });
  }
  </script> -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

</head>

<body>

  <header class="header">
    <h1><img alt="logo for markheard.io" src="./assets/markheardio.svg" /></h1>
  </header>

  <nav class="nav">
    <button class="fab toggle">
      <img alt="menu icon" class="toggle" src="./assets/menu-24px-light.svg" />
    </button>
    <div class="menu">
      <div class="menu-item ">
        <a href="./">Home</a>
      </div>
      <div class="menu-item ">
        <a href="./about">About</a>
      </div>
      <div class="menu-item ">
        <a href="./portfolio">Portfolio</a>
      </div>
    </div>
  </nav>



  <main class="main">
    <div id="content">
      <div class="card grad contact">
        <form class="form">

          <div class="form-title">
            <h1>Contact Me</h1>
            <h3>Got a question?</h3>
            <h3>Send me a message!</h3>
          </div>

          <div class="form-group">
            <label>Name</label>
            <input id="name" type="text" />
          </div>

          <div class="form-group">
            <label>Email</label>
            <input id="email" type="text" />
          </div>

          <div class="form-group">
            <label>Message</label>
            <textarea id="message"></textarea>
          </div>

          <div class="form-group">
            <button id="sendMessage" class="g-recaptcha btn" data-sitekey="6Lf1l9YUAAAAAF3F3RS2JbncOFxHAPMyH7HxWFwj"
              data-callback="onSubmit" data-badge="inline" data-size="invisible">
              Send
            </button>
          </div>

          <!-- <div class="form-group">
            <div id="testLoader" class="btn">
              test load
            </div>
            
          </div> -->

        </form>
 
      </div>
      
    </div>
  </main>

  <div id="modal" class="">
    <div class="modal-bg"></div>
    <div id="modalDialogue"></div>
  </div>

  <!-- <div id="loader" class="hidden">
    <div class="loader-bg"></div>
    <div class="loader-message">Sending</div>
    <div class="loader-ring r-1"></div>
    <div class="loader-ring r-2"></div>
    <div class="loader-ring r-3"></div>
    <div class="loader-ring r-4"></div>
    <div class="loader-ring r-5"></div>
  </div> -->



  <script src="./scripts/app.js" async></script>


  <script>

    (function () {

      function sendMessage(e) {
        e.preventDefault();
      }

      document.getElementById("sendMessage").onclick = sendMessage;

      function clearModal() {
        document.getElementById('modal-dialogue').innerHTML = '';
        document.getElementById('modal').classList.remove('open')
      }

      function clearContactForm() {
        document.getElementById('name').value = '';
        document.getElementById('email').value = '';
        document.getElementById('message').value = '';
      }



      function openLoadModal(){
        
        var modalDialogue = document.getElementById('modalDialogue');

        modalDialogue.innerHTML = '';
        modalDialogue.classList.add('loadingModal')

        var loader = document.createElement('DIV');
        loader.classList.add('loader');

       

        var loaderSVG = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        //loaderSVG.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");

        var loadCircle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        loadCircle.setAttribute('cx','100');
        loadCircle.setAttribute('cy','100');
        loadCircle.setAttribute('r','80');
        loadCircle.setAttribute('transform', 'rotate(-90 100 100)');

        loaderSVG.append(loadCircle);
        loader.append(loaderSVG);

        var loadMsg = document.createElement('DIV');
        loadMsg.innerHTML='Sending...';
        loadMsg.classList.add('loadMsg');
        loader.append(loadMsg);

        modalDialogue.append(loader);

        document.getElementById('modal').classList.add('open');

      }
      //document.getElementById('testLoader').addEventListener('click', openLoadModal);

      function closeLoadModal (){
        var modalDialogue = document.getElementById('modalDialogue');

        modalDialogue.innerHTML = '';
        modalDialogue.classList.remove('loadingModal');
      }


      function onSubmit(token) {

        var url = 'https://test-1-rvw7oyp6nq-uc.a.run.app'

        var message = {
          token: token,
          name: document.getElementById("name").value,
          email: document.getElementById("email").value,
          message: document.getElementById("message").value
        };

        var xhr = new XMLHttpRequest();


        xhr.open('POST', url, true);
        //Send the proper header information along with the request
        xhr.setRequestHeader('Content-type', 'application/json');
        xhr.onreadystatechange = function () {//Call a function when the state changes.
          openLoadModal();
          if (xhr.readyState == 4 && xhr.status == 200) {
            
            var data = JSON.parse(xhr.responseText);


            //document.getElementById("loader").classList.add("hidden");
            //document.getElementById("modal").classList.remove("hidden");

            //var modal = document.getElementById("modal")
            //var modalDialogue = document.getElementById("modal-dialogue");
  
            
            if (data.success === true) {
              closeLoadModal();
              // var successMessage = document.createElement("DIV");
              // successMessage.classList.add("success-message");
              // successMessage.textContent = "Message Received"
              // var check = document.createElement("DIV");
              // check.classList.add("check");
              // var before = document.createElement("DIV");
              // before.classList.add("before");
              // var after = document.createElement("DIV");
              // after.classList.add("after");
              // check.append(before);
              // check.append(after);
              // modalDialogue.append(successMessage);
              // modalDialogue.append(check);
              // document.getElementById("modal").classList.add("open")

              setTimeout(function () {
                clearModal();
                clearContactForm();
              }, 5000);

            } else {

              // var errorMessage = document.createElement("DIV");
              // errorMessage.classList.add("error-message");
              // errorMessage.textContent = "Message Failed";
              // var errorDetail = document.createElement("DIV");
              // errorDetail.classList.add("error-detail");
              // errorDetail.textContent = "Your message could not be sent please try again later";
              // var cross = document.createElement("DIV");
              // check.classList.add("cross");
              // var top = document.createElement("DIV");
              // before.classList.add("top");
              // var bottom = document.createElement("DIV");
              // after.classList.add("bottom");
              // check.append(top);
              // check.append(bottom);
              // modalDialogue.append(errorMessage);
              // modalDialogue.append(errorDetail);
              // modalDialogue.append(cross);
              // var closeBtn = document.createElement("BUTTON");
              // closeBtn.classList.add('close-btn');

              // modalDialogue.append(closeBtn);
              // document.getElementById("modal").classList.add("open")

            }
          }
        }
        xhr.send(JSON.stringify(message));

      }
      window.onSubmit = onSubmit

    })();

  </script>

</body>

</html>